# Understanding Swift Performance

> _ì´ ê¸€ì€ [WWDC 2016 - Understanding Swift Performance](https://developer.apple.com/videos/play/wwdc2016/416/
)ì˜ ë‚´ìš©ì„ ê³µë¶€í•˜ê³ , ê°œì¸ì ìœ¼ë¡œ ì •ë¦¬í•´ë†“ì€ ê¸€ì…ë‹ˆë‹¤._

## 1. stack í• ë‹¹ê³¼ heap í• ë‹¹ 

### stack í• ë‹¹
- ì²˜ìŒì—ëŠ” ìŠ¤íƒ í• ë‹¹ê³¼ í™ í• ë‹¹ì— ì°¨ì´ì— ëŒ€í•´ì„œ ì„¤ëª…í•©ë‹ˆë‹¤. ìµíˆ ì•„ëŠ”ëŒ€ë¡œ ê°’íƒ€ì…ì€ ìŠ¤íƒì— ì €ì¥ë˜ê³  ìŠ¤íƒì€ ë‹¨ìˆœí•œ ìë£Œêµ¬ì¡°ì´ì§€ìš”. ì»´íŒŒì¼ íƒ€ì„ì— ì´ë¯¸ ìŠ¤íƒ ë©”ëª¨ë¦¬ì— ê³µê°„ì´ í• ë‹¹ë˜ê³ , ëŸ°íƒ€ì„ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•ŒëŠ” ì´ë¯¸ í• ë‹¹ëœ ê³µê°„ì— ê°’ì„ ì´ˆê¸°í™”ë§Œ í•´ì£¼ë©´ ë˜ì§€ìš”. 
- ê·¸ë¦¬ê³  point1, point2ëŠ” ë…ë¦½ì ì´ê¸° ë•Œë¬¸ì— point2ê°€ ë³€ê²½ë˜ì–´ë„ point1ì—ëŠ” ì˜í–¥ì´ ì—†ê³ , ë‘˜ ë‹¤ ì‚¬ìš©ì´ ëë‚˜ë©´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œë˜ì£ . 

![](https://velog.velcdn.com/images/dev_kickbell/post/f5b22af7-16ec-46a1-860c-01c1363d67a4/image.png)
![](https://velog.velcdn.com/images/dev_kickbell/post/8bf64e69-d034-4494-b3c3-7f9f619b9b3f/image.png)
![](https://velog.velcdn.com/images/dev_kickbell/post/ee44fd5f-41d0-48a6-a3b4-409afc4e581d/image.png)


### heap í• ë‹¹
- í™ í• ë‹¹ì€ ì¡°ê¸ˆ ë” ë³µì¡í•©ë‹ˆë‹¤. ì»´íŒŒì¼ íƒ€ì„ì—ëŠ” point1, point2ì˜ ì°¸ì¡°ë¥¼ ìœ„í•´ì„œ ìŠ¤íƒì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ì£ . 
- ê·¸ë¦¬ê³  ëŸ°íƒ€ì„ì´ ë˜ë©´, SwiftëŠ” í™ì„ ì ê·¸ê³  ì ë‹¹í•œ í¬ê¸°ì˜ ì‚¬ìš©ë˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤. ì™œëƒë©´, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— í™ì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ì£ . ê·¸ë¦¬ê³ ë‚˜ì„œ ë¹ˆ ê³µê°„ì„ ì°¾ëŠ”ë° ì„±ê³µí•˜ë©´ ë©”ëª¨ë¦¬ì— ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤. 
- point2 = point1ë¥¼ í•˜ê²Œë˜ë©´ í™ì— ìˆëŠ” ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ì£ . ê·¸ë˜ì„œ point2 = 5 ì™€ ê°™ì€ ì‘ì—…ì„ í•˜ë©´ ì˜ë„ì¹˜ ì•Šì€ ê³µìœ ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/dev_kickbell/post/a9ec667e-a140-478e-9512-c90ff54107a4/image.png)![](https://velog.velcdn.com/images/dev_kickbell/post/360a6592-0b27-4e23-8a80-a8fdbc5b2893/image.png)![](https://velog.velcdn.com/images/dev_kickbell/post/f54549ff-78db-4763-b904-5ee4a69ee937/image.png)![](https://velog.velcdn.com/images/dev_kickbell/post/836825ef-d800-4f9c-a66a-97032010feb7/image.png)


### ê²°ë¡  

- ê²°ë¡ ì ìœ¼ë¡œëŠ” í´ë˜ìŠ¤ëŠ” í™ í• ë‹¹ì´ í•„ìš”í•˜ê³ , ë¹ˆ ê³µê°„ì„ ì°¾ì•„ì•¼ í•˜ê³  ê·¸ë™ì•ˆ í™ì„ ì ê¶ˆì„œ ë¬´ê²°ì„±ì„ ìœ ì§€í•´ì•¼ í•˜ëŠ” ë“±ì˜ ë¶€ê°€ì ì¸ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. ì˜ë„ì¹˜ ì•Šì€ ìƒíƒœ ê³µìœ ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ë„ ìˆì£ . 
- ë°˜ë©´ì— ìŠ¤íƒì€ í™ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë” ë¹ ë¥´ì§€ìš”. ê°’ì„ ë³µì‚¬í•˜ë¯€ë¡œ ì˜ë„ì¹˜ ì•Šì€ ìƒíƒœ ê³µìœ ì— ì·¨ì•½í•˜ì§€ë„ ì•ŠìŠµë‹ˆë‹¤. ì•±ì„ ë””ìì¸í•˜ëŠ”ë° ì¶”ìƒí™”ì˜ ì´ëŸ° íŠ¹ì„±ì´ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš°ë¼ë©´ ê°’ íƒ€ì…ì¸ êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŠµë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/dev_kickbell/post/102d6118-8826-4885-9d80-1c195651acd7/image.png)![](https://velog.velcdn.com/images/dev_kickbell/post/19e0cbfd-970b-4dd9-bedb-e6dbbab8ec33/image.png)


## 2. ì½”ë“œ ì˜ˆì‹œë¥¼ í†µí•œ structì˜ ì‚¬ìš© 

### key ê°’ìœ¼ë¡œ Stringì„ ì‚¬ìš©(ë¬¸ìì—´ì„ í™ì— ì €ì¥, í™ í• ë‹¹) 
- ë§í’ì„ ì„ ë§Œë“¤ê²ë‹ˆë‹¤. ëŒ€ì¶© ì´ëŸ° ëª¨ì–‘ ğŸ’¬, ğŸ’­ ì´ê² ì£ ? ê·¸ëŸ°ë° ë‹¹ì—°íˆ ë°˜ëŒ€ìª½ ëª¨ì–‘ë„ ìˆì„ê²ë‹ˆë‹¤. ê·¸ë˜ì„œ Orientaionì´ ìˆê³ , ë‚´ê°€ ë³´ë‚¸ ë§í’ì„ ì˜ ìƒ‰ì€ ë‹¬ëìœ¼ë©´ ì¢‹ê² ìœ¼ë‹ˆ Colorë„ ìˆìŠµë‹ˆë‹¤. ë˜, ë§¨ ì²˜ìŒ ì±„íŒ…ë§Œ ë§í’ì„  ê¼¬ë¦¬ê°€ ìˆì–´ì•¼ í•´ì„œ noneê³¼ ë§í’ì„  ê¼¬ë¦¬ 2ì¢…ë¥˜ê°€ ì¶”ê°€ëœ Tailë„ ìˆìŠµë‹ˆë‹¤.
- ê·¸ë¦¬ê³  makeBalloon ë©”ì†Œë“œë¥¼ ìƒì„±í–ˆì–´ìš”. ê·¸ëŸ°ë°, ì´ ë§í’ì„ ì€ ì±„íŒ…ë°©ì—ì„œ ìŠ¤í¬ë¡¤í•˜ë©´ì„œ ìˆ˜ì—†ì´ ë§ì´ í˜¸ì¶œë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë§¤ìš° ë¹¨ë¼ì•¼ í•´ìš”. ê·¸ë˜ì„œ var cache ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. í•œë²ˆë§Œ ìƒì„±í•˜ë©´ ê·¸ ì´í›„ë¶€í„°ëŠ” í‚¤ê°’ì— ë”°ë¼ì„œ ë°”ë¡œ êº¼ë‚¼ ìˆ˜ ìˆê²Œ ë§ì´ì£ . 
- ê·¸ëŸ°ë° ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ë­˜ê¹Œìš”? ë°”ë¡œ keyê°’ì¸ String ì…ë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/dev_kickbell/post/18318bf3-72b4-42b8-ba2c-dabc537bd472/image.png)

### key ê°’ìœ¼ë¡œ enum, structë¥¼ ì‚¬ìš©(í™ í• ë‹¹ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ) 
- ì™œ Stringì´ ë¬¸ì œì¼ê¹Œìš” ? Swiftì—ì„œ Stringì€ êµ¬ì¡°ì²´ë‹ˆê¹Œ ê°’íƒ€ì…ì´ì£ ? ê·¸ëŸ¬ë©´ í™ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìŠ¤íƒë§Œ ì‚¬ìš©í•˜ê² ë„¤ìš”? ê·¸ëŸ´ ê²ƒ ê°™ì§€ë§Œ ê·¸ë ‡ì§€ë„ ì•Šë‹¤ê³  í•©ë‹ˆë‹¤. 
- ì™œëƒë©´, ì € keyë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆì§€ë§Œ keyì˜ ê°’ì´ ê°€ë³€ì ì´ì£ . ê¸¸ì´ê°€ 1ìì¼ì§€ 1000ìì¼ì§€ ëª¨ë¥´ëŠ” ê²ë‹ˆë‹¤. ì»´íŒŒì¼ íƒ€ì…ì— ê¸¸ì´ê°€ ì •í•´ì ¸ ìˆì§€ ì•Šì£ . ê·¸ë˜ì„œ Swiftì—ì„œ Stringì€ í™ì„ ê°„ì ‘ì ìœ¼ë¡œ ì´ìš©í•œë‹¤ê³  í•©ë‹ˆë‹¤. ì •í™•íˆëŠ” ë¬¸ìì—´ ê°’ì„ í™ì— ì €ì¥í•œë‹¤ê³  í•´ìš”. ì´ê²ƒì€ Swiftì˜ ì»¬ë ‰ì…˜ íƒ€ì…ì¸ Array, Dictionary ê°™ì€ ë…€ì„ë“¤ë„ ë§ˆì°¬ê°€ì§€ë¼ê³  í•´ìš”. 
- ê·¸ëŸ¬ë©´ ì´ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ê°œì„ í•˜ë©´ ì¢‹ì„ê¹Œìš” ? í™ì„ ì‚¬ìš©í•˜ì§€ ì•Šê²Œ í•˜ë©´ ë  ê²ƒ ê°™ì•„ìš”. 
- í•´ê²°ì±…ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. Attributeë¼ëŠ” êµ¬ì¡°ì²´ë¥¼ ë§Œë“­ë‹ˆë‹¤. ê·¸ë¦¬ê³  Hashableì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤. Swiftì—ì„œ êµ¬ì¡°ì²´ëŠ” ì¼ê¸‰ ê°ì²´ì´ë¯€ë¡œ keyê°’ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í™ í• ë‹¹ì´ í•„ìš” ì—†ì–´ì§€ë¯€ë¡œ ë” íš¨ìœ¨ì ì¸ ì½”ë“œê°€ ë©ë‹ˆë‹¤. 
- ê°„ì ‘ì ìœ¼ë¡œ í™ í• ë‹¹ì„ ì‚¬ìš©í–ˆë˜ Stringì„ ì œê±°í•¨ìœ¼ë¡œì¨ ìŠ¤íƒì— í• ë‹¹í•  ìˆ˜ ìˆëŠ” ê²ƒì´ì£ . í›¨ì”¬ ë” ì•ˆì „í•˜ê³  ë” ë¹ ë¦…ë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/dev_kickbell/post/a12f9ed5-ea1c-404c-a8ee-d3fb2088ccfb/image.png)



## 3. Structì˜ Reference Count 

### ì°¸ì¡°ë¥¼ í¬í•¨í•˜ëŠ” structì€ ì–´ë–¨ê¹Œìš” ? 
- Swiftì—ì„œëŠ” ARCê°€ ìë™ìœ¼ë¡œ refCountë¥¼ ì²˜ë¦¬í•´ì£¼ì£ . ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ refCountë¥¼ 1ì”© ì˜¬ë ¤ì£¼ê³ , ì‚¬ìš©ì´ ëë‚˜ë©´ 1ì”© ë‚´ë ¤ì¤˜ì„œ ê²°êµ­ì— 0ì´ë˜ë©´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œë©ë‹ˆë‹¤. 
- ì¤‘ìš”í•œ ê²ƒì€, ì´ê²ƒì´ ë§¤ìš° ë¹ˆë²ˆí•˜ê³  ì‹¤ì œë¡œëŠ” ì •ìˆ˜ë¥¼ ì¦ê°€/ê°ì†Œ ì‹œí‚¤ëŠ” ê²ƒë³´ë‹¤ ë” ë§ì€ ì‘ì—…ì´ ìˆë‹¤ëŠ” ê±°ì—ìš”. ì²«ì§¸ë¡œëŠ” ì‹¤í–‰í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨ëœ ëª‡ ê°€ì§€ ê°„ì ‘ ì°¸ì¡°ê°€ ìˆë‹¤ëŠ” ê²ƒì´ê³  ë‘˜ì§¸ë¡œëŠ” í™ í• ë‹¹ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë™ì‹œì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œì˜ í™ ì¸ìŠ¤í„´ìŠ¤ì— ì°¸ì¡°ë¥¼ ì¶”ê°€/ì œê±° í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— thread safetyë¥¼ ê³ ë ¤í•´ì•¼ í•œë‹¤ëŠ” ê²ë‹ˆë‹¤. 
- structëŠ” refCountê°€ ì—†ì„ê¹Œìš”? ê·¸ë ‡ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. Stringê³¼ UIFontê°€ í¬í•¨ëœ ì•„ë˜ì˜ ì½”ë“œë¥¼ ë³´ì£ . Stringì€ ìœ„ì—ì„œ ë§í–ˆë˜ ê²ƒì²˜ëŸ¼ ì‹¤ì œë¡œ í•´ë‹¹ ë¬¸ìì˜ ë‚´ìš©ì„ í™ì— ì €ì¥í•œë‹¤ê³  í–ˆì£ ? ê·¸ë˜ì„œ refCountê°€ í•„ìš”í•©ë‹ˆë‹¤. UIFontëŠ” í´ë˜ìŠ¤ë‹ˆê¹Œ ë‹¹ì—°íˆ í•„ìš”í•˜ê² ì£ . 
- ì²˜ìŒì— label1ì— 2ê°œì˜ ì°¸ì¡°ê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  let label2ë¼ëŠ” ì‚¬ë³¸ì„ ë§Œë“¤ ë•Œ ì‹¤ì œë¡œ 2ê°œì˜ ì°¸ì¡°ë¥¼ ë” ì¶”ê°€í•©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” text storageì— í•˜ë‚˜ëŠ” fontì— ì¶”ê°€í•˜ì£ . ì´ëŸ° í™ í• ë‹¹ì€ refCountì˜ retain/releaseì— ëŒ€í•œ í˜¸ì¶œì„ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/dev_kickbell/post/8071e1fe-ba13-4265-bb54-d32ab9db5c90/image.png)![](https://velog.velcdn.com/images/dev_kickbell/post/109ecd48-cd5b-4d86-ab7c-db6dfe68666c/image.png)![](https://velog.velcdn.com/images/dev_kickbell/post/213e7493-008c-4457-8fb6-72496027d275/image.png)


### ì°¸ì¡°ë¥¼ 2ê°œ ì´ìƒ í¬í•¨í•˜ëŠ” structì˜ ê²½ìš° classë³´ë‹¤ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤. 
- ê²°ë¡ ì ìœ¼ë¡œ í´ë˜ìŠ¤ì˜€ìœ¼ë©´ reference counting overhaedê°€ 2ê°œë©´ ëì„ê±´ë°, structëŠ” label1ê³¼ label2ì´ ë…ë¦½ì ì¸ ì¸ìŠ¤í„´ìŠ¤ì´ë¯€ë¡œ reference counting overhaedê°€ 4ê°œê°€ ë°œìƒë˜ì–´ ë²„ë¦½ë‹ˆë‹¤. 
- ì‹¤ì œë¡œ êµ¬ì¡°ì²´ëŠ” í¬í•¨ëœ ì°¸ì¡° ìˆ˜ì— ë¹„ë¡€í•˜ëŠ” reference counting overhaedë¥¼ ì§€ë¶ˆí•˜ê²Œ ë˜ëŠ” ê±°ì£ . 2ê°œ ì´ìƒì˜ ì°¸ì¡°ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì¡°ì²´ì˜ ê²½ìš° ì˜¤íˆë ¤ í´ë˜ìŠ¤ë³´ë‹¤ íš¨ìœ¨ì´ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤. 
- í´ë˜ìŠ¤ì˜ ê²½ìš° 
    - ![](https://velog.velcdn.com/images/dev_kickbell/post/b2eee608-3a8a-4216-a21b-9494379ff48f/image.png)
- êµ¬ì¡°ì²´ì˜ ê²½ìš° 
    - ![](https://velog.velcdn.com/images/dev_kickbell/post/9d4588c5-7da9-4a30-ab0b-a39e31a93240/image.png)
- ì°¸ì¡°ê°€ í¬í•¨ëœ êµ¬ì¡°ì²´ì˜ ê²½ìš°
    - ![](https://velog.velcdn.com/images/dev_kickbell/post/2a698d38-5bb1-4247-9141-13e014039f55/image.png)
    - ![](https://velog.velcdn.com/images/dev_kickbell/post/e26193c4-1043-4b23-8629-7376f804fc15/image.png)



## 4. ì°¸ì¡°ê°€ í¬í•¨ëœ structì˜ ì„±ëŠ¥ ê°œì„ 






## ì¶”ê°€ë¡œ ë“¤ì–´ë³´ë©´ ì¢‹ì€ ì„¸ì…˜ë“¤
![](https://velog.velcdn.com/images/dev_kickbell/post/84825fdb-c03e-4035-aa68-54c2608dd089/image.png)










static ì€ ì»´íŒŒì¼ì— ì €ê¸°í•œë‹¤.
dynamic ì€ ì‹¤í–‰ì¤‘ì— ì €ê¸°ëœë‹¤.
ì¸ë¼ì¸.
êµ¬ì¡°ì²´ë©´ ê°€ëŠ¥í•˜ë‹¤.
ì í”„ì í”„ì•ˆí•˜ê³  ê·¸ëŒ€ë¡œ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ì‹¤í–‰í•˜ëŠ”ê²ƒ? ì´ë‹¤.
í´ë˜ìŠ¤ë¡œ í•˜ë©´ drawbleì„ ìƒì†ë°›ì€ ëª¨ë‘ê°€ ë‹¤ë“¤ì–´ì˜¬ìˆ˜ìˆì–´ì„œ. d.draw()ë¥¼ í•´ë„
ì»´íŒŒì¼íƒ€ì…ì—ëŠ” ì•Œìˆ˜ê°€ ì—†ë‹¤.
v-table dispatch. ì í”„ì í”„í•´ì„œ ì°¾ì•„ê°€ì•¼ëœë‹¤. ì¦‰, ì‹¤í–‰ì¤‘ì— ì°¾ì•„ê°€ì•¼ëœë‹¤.
ê·¸ë˜ì„œ ì´ëŸ°ê±¸ ë‹¤ì´ë‚´ë¯¹ ë””ìŠ¤íŒ¨ì¹˜ë¼ê³  í•œë‹¤.



## í™, ìŠ¤íƒí• ë‹¹

ë ˆí¼ëŸ°ìŠ¤ íƒ€ì… -> í™í• ë‹¹
ë°¸ë¥˜ íƒ€ì… -> ìŠ¤íƒí• ë‹¹

## swift ì¢…ë¥˜ë³„ ê°’, ì°¸ì¡°íƒ€ì…

1. ì°¸ì¡° reference íƒ€ì…
- class
- function
- closure

2. ê°’ value íƒ€ì… 
- struct 
- enum 
public struct Int
public struct Bool
public struct Float
public struct Double
public struct Character
public struct String
public struct Dictionary<Key : Hashable, Value>
public struct Array<Element>
public struct Set<Element : Hashable>  
Tupleë„. 

 


